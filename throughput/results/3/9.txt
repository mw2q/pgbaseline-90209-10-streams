BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%linen%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 258187538.426645
 ALGERIA                   |   1997 | 448138230.369078
 ALGERIA                   |   1996 | 456930041.621744
 ALGERIA                   |   1995 | 455964842.831279
 ALGERIA                   |   1994 | 446732381.674861
 ALGERIA                   |   1993 | 453969639.113753
 ALGERIA                   |   1992 | 449555606.021363
 ARGENTINA                 |   1998 |  275657307.30518
 ARGENTINA                 |   1997 | 471547229.717796
 ARGENTINA                 |   1996 | 469709263.076889
 ARGENTINA                 |   1995 | 474502282.833727
 ARGENTINA                 |   1994 | 464472515.763827
 ARGENTINA                 |   1993 | 474361731.369668
 ARGENTINA                 |   1992 | 478004744.593185
 BRAZIL                    |   1998 | 277604127.656323
 BRAZIL                    |   1997 | 470087347.322279
 BRAZIL                    |   1996 | 461480293.588382
 BRAZIL                    |   1995 | 463528601.697699
 BRAZIL                    |   1994 | 464201396.392965
 BRAZIL                    |   1993 | 461201961.867568
 BRAZIL                    |   1992 | 467606006.912751
 CANADA                    |   1998 |  272144404.40987
 CANADA                    |   1997 | 476511937.591473
 CANADA                    |   1996 | 475277418.942248
 CANADA                    |   1995 | 472449169.116575
 CANADA                    |   1994 | 473484159.422683
 CANADA                    |   1993 | 474684279.176508
 CANADA                    |   1992 | 471201385.204917
 CHINA                     |   1998 | 272344365.207176
 CHINA                     |   1997 | 464989466.153741
 CHINA                     |   1996 | 464333876.315466
 CHINA                     |   1995 | 461071732.423244
 CHINA                     |   1994 | 463474173.484895
 CHINA                     |   1993 | 465103111.024772
 CHINA                     |   1992 | 470742734.985172
 EGYPT                     |   1998 | 271414326.141942
 EGYPT                     |   1997 | 458331228.123703
 EGYPT                     |   1996 | 470886698.131041
 EGYPT                     |   1995 | 463053788.832868
 EGYPT                     |   1994 | 462718806.496247
 EGYPT                     |   1993 | 459220498.879605
 EGYPT                     |   1992 | 469044431.962572
 ETHIOPIA                  |   1998 | 264594161.397802
 ETHIOPIA                  |   1997 | 450856158.706938
 ETHIOPIA                  |   1996 | 441348806.718257
 ETHIOPIA                  |   1995 | 451861173.790822
 ETHIOPIA                  |   1994 | 456179439.878367
 ETHIOPIA                  |   1993 | 447598254.603396
 ETHIOPIA                  |   1992 | 457173639.002551
 FRANCE                    |   1998 | 263158718.846576
 FRANCE                    |   1997 | 453178040.072022
 FRANCE                    |   1996 | 447304788.868504
 FRANCE                    |   1995 | 445269628.637483
 FRANCE                    |   1994 | 453455976.023407
 FRANCE                    |   1993 | 453162241.360892
 FRANCE                    |   1992 | 459137668.683273
 GERMANY                   |   1998 | 278923161.615442
 GERMANY                   |   1997 | 470157585.306748
 GERMANY                   |   1996 | 474338858.786472
 GERMANY                   |   1995 | 471465108.299252
 GERMANY                   |   1994 |  478762604.24911
 GERMANY                   |   1993 | 477812724.174096
 GERMANY                   |   1992 | 470454178.060663
 INDIA                     |   1998 | 279910710.261211
 INDIA                     |   1997 | 474773974.909138
 INDIA                     |   1996 | 476069983.318325
 INDIA                     |   1995 | 472457092.796183
 INDIA                     |   1994 | 479656801.634059
 INDIA                     |   1993 | 476887433.472885
 INDIA                     |   1992 | 482260378.289734
 INDONESIA                 |   1998 | 273937804.479782
 INDONESIA                 |   1997 | 463008697.940277
 INDONESIA                 |   1996 | 464162682.082978
 INDONESIA                 |   1995 | 459957708.924826
 INDONESIA                 |   1994 | 462002943.357467
 INDONESIA                 |   1993 | 457950006.477609
 INDONESIA                 |   1992 | 457177942.723032
 IRAN                      |   1998 |  273183760.65401
 IRAN                      |   1997 | 459124839.665077
 IRAN                      |   1996 | 469635913.438627
 IRAN                      |   1995 | 473101947.050425
 IRAN                      |   1994 | 468622984.848291
 IRAN                      |   1993 | 467399451.356823
 IRAN                      |   1992 | 468433106.070513
 IRAQ                      |   1998 | 276968374.334929
 IRAQ                      |   1997 | 474419819.955477
 IRAQ                      |   1996 | 476438559.076043
 IRAQ                      |   1995 | 477756948.766105
 IRAQ                      |   1994 | 474365567.309625
 IRAQ                      |   1993 | 477762407.530028
 IRAQ                      |   1992 | 468281659.251618
 JAPAN                     |   1998 | 268782961.569279
 JAPAN                     |   1997 | 464582271.939886
 JAPAN                     |   1996 | 460093970.578486
 JAPAN                     |   1995 | 455692845.325668
 JAPAN                     |   1994 | 463882554.298935
 JAPAN                     |   1993 | 458055108.181754
 JAPAN                     |   1992 |  454734188.39141
 JORDAN                    |   1998 | 273755428.147077
 JORDAN                    |   1997 | 459547284.999892
 JORDAN                    |   1996 | 460934821.587995
 JORDAN                    |   1995 | 463200726.620706
 JORDAN                    |   1994 | 460858252.542098
 JORDAN                    |   1993 | 462514153.885821
 JORDAN                    |   1992 | 464529146.912574
 KENYA                     |   1998 | 267405947.337191
 KENYA                     |   1997 | 463551941.905097
 KENYA                     |   1996 | 472472757.020615
 KENYA                     |   1995 |  466845137.56878
 KENYA                     |   1994 | 470050876.914986
 KENYA                     |   1993 | 464654122.291816
 KENYA                     |   1992 | 461605085.045264
 MOROCCO                   |   1998 | 270507610.881712
 MOROCCO                   |   1997 | 458384788.212298
 MOROCCO                   |   1996 | 469998841.478819
 MOROCCO                   |   1995 | 454546845.730814
 MOROCCO                   |   1994 | 456286508.040229
 MOROCCO                   |   1993 | 459029166.546286
 MOROCCO                   |   1992 | 471939548.189151
 MOZAMBIQUE                |   1998 | 272931993.128146
 MOZAMBIQUE                |   1997 | 465396081.250878
 MOZAMBIQUE                |   1996 |  463768499.86736
 MOZAMBIQUE                |   1995 | 465268051.448624
 MOZAMBIQUE                |   1994 | 460652321.536484
 MOZAMBIQUE                |   1993 | 467403908.699073
 MOZAMBIQUE                |   1992 | 458162391.211271
 PERU                      |   1998 | 268977946.210415
 PERU                      |   1997 | 468405740.331756
 PERU                      |   1996 | 464568526.944066
 PERU                      |   1995 | 472396268.695167
 PERU                      |   1994 | 468216183.792167
 PERU                      |   1993 | 464218456.236896
 PERU                      |   1992 | 478123273.466452
 ROMANIA                   |   1998 | 275733943.104078
 ROMANIA                   |   1997 | 461360464.056802
 ROMANIA                   |   1996 | 476985147.807506
 ROMANIA                   |   1995 | 469248966.461025
 ROMANIA                   |   1994 | 474201345.196022
 ROMANIA                   |   1993 | 465334920.145837
 ROMANIA                   |   1992 | 466998700.051908
 RUSSIA                    |   1998 | 270674110.265905
 RUSSIA                    |   1997 | 467101300.905527
 RUSSIA                    |   1996 | 464545889.565963
 RUSSIA                    |   1995 | 464716082.487058
 RUSSIA                    |   1994 | 457228863.114842
 RUSSIA                    |   1993 | 460504544.202933
 RUSSIA                    |   1992 | 468627868.594074
 SAUDI ARABIA              |   1998 | 273567610.085337
 SAUDI ARABIA              |   1997 | 463885932.414397
 SAUDI ARABIA              |   1996 | 472951149.998723
 SAUDI ARABIA              |   1995 | 470634074.127415
 SAUDI ARABIA              |   1994 | 460551062.945621
 SAUDI ARABIA              |   1993 | 469256129.081442
 SAUDI ARABIA              |   1992 | 464407691.450733
 UNITED KINGDOM            |   1998 | 273776163.501408
 UNITED KINGDOM            |   1997 | 472527456.699201
 UNITED KINGDOM            |   1996 | 466792441.862462
 UNITED KINGDOM            |   1995 | 466385367.968003
 UNITED KINGDOM            |   1994 | 463110767.854943
 UNITED KINGDOM            |   1993 | 455334145.717705
 UNITED KINGDOM            |   1992 | 461900157.951114
 UNITED STATES             |   1998 | 278955006.356946
 UNITED STATES             |   1997 | 467431947.248278
 UNITED STATES             |   1996 | 471695763.665361
 UNITED STATES             |   1995 | 474505800.059195
 UNITED STATES             |   1994 |  480938092.81949
 UNITED STATES             |   1993 | 470510187.543991
 UNITED STATES             |   1992 | 473719919.403259
 VIETNAM                   |   1998 | 274821239.772302
 VIETNAM                   |   1997 | 463772782.523966
 VIETNAM                   |   1996 | 473930663.167937
 VIETNAM                   |   1995 |  462990858.84707
 VIETNAM                   |   1994 | 469056062.601825
 VIETNAM                   |   1993 |  469340863.04929
 VIETNAM                   |   1992 | 469232030.013852
(175 rows)

COMMIT;
COMMIT
