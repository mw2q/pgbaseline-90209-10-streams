BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%brown%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 268784713.956298
 ALGERIA                   |   1997 | 458835598.580921
 ALGERIA                   |   1996 | 457709251.413512
 ALGERIA                   |   1995 |  455521844.07491
 ALGERIA                   |   1994 | 459830392.153196
 ALGERIA                   |   1993 | 459763957.430226
 ALGERIA                   |   1992 | 461117479.423866
 ARGENTINA                 |   1998 | 272652389.723809
 ARGENTINA                 |   1997 | 464404163.298139
 ARGENTINA                 |   1996 | 471256194.284625
 ARGENTINA                 |   1995 | 468052632.040934
 ARGENTINA                 |   1994 | 466396228.308505
 ARGENTINA                 |   1993 | 470034575.922911
 ARGENTINA                 |   1992 |  465080167.95861
 BRAZIL                    |   1998 | 272971554.920078
 BRAZIL                    |   1997 | 464124433.462424
 BRAZIL                    |   1996 | 458159549.995292
 BRAZIL                    |   1995 | 454078210.249361
 BRAZIL                    |   1994 | 458891219.176897
 BRAZIL                    |   1993 | 463829847.558452
 BRAZIL                    |   1992 | 463996872.570879
 CANADA                    |   1998 | 281578549.622029
 CANADA                    |   1997 | 470238133.819437
 CANADA                    |   1996 | 478916576.134761
 CANADA                    |   1995 | 476238002.603091
 CANADA                    |   1994 | 479583291.868582
 CANADA                    |   1993 | 474696324.480316
 CANADA                    |   1992 | 475708518.340489
 CHINA                     |   1998 | 268051358.979386
 CHINA                     |   1997 | 459995241.531476
 CHINA                     |   1996 | 464224700.684864
 CHINA                     |   1995 |  466705906.52618
 CHINA                     |   1994 |  460518848.24994
 CHINA                     |   1993 | 461919820.694199
 CHINA                     |   1992 | 462753086.684625
 EGYPT                     |   1998 | 269547159.126949
 EGYPT                     |   1997 |  465006107.65808
 EGYPT                     |   1996 | 469173172.253316
 EGYPT                     |   1995 | 465683158.469033
 EGYPT                     |   1994 | 460700284.609397
 EGYPT                     |   1993 | 461985543.650598
 EGYPT                     |   1992 |  460930821.40986
 ETHIOPIA                  |   1998 | 265953827.233693
 ETHIOPIA                  |   1997 | 450065296.888963
 ETHIOPIA                  |   1996 | 456067608.228242
 ETHIOPIA                  |   1995 | 447839483.552091
 ETHIOPIA                  |   1994 |   455027246.2888
 ETHIOPIA                  |   1993 | 446655394.654912
 ETHIOPIA                  |   1992 | 454622658.170724
 FRANCE                    |   1998 | 270443606.565809
 FRANCE                    |   1997 | 458203938.732547
 FRANCE                    |   1996 | 457441956.567942
 FRANCE                    |   1995 | 468316959.794278
 FRANCE                    |   1994 | 459429748.667355
 FRANCE                    |   1993 | 462926486.723263
 FRANCE                    |   1992 | 455454654.345697
 GERMANY                   |   1998 | 277519739.252887
 GERMANY                   |   1997 | 471924886.582742
 GERMANY                   |   1996 | 466663219.177356
 GERMANY                   |   1995 | 476340137.623993
 GERMANY                   |   1994 |  475177641.53811
 GERMANY                   |   1993 | 470392270.098179
 GERMANY                   |   1992 | 472381363.031482
 INDIA                     |   1998 | 279870312.876831
 INDIA                     |   1997 |  478485914.62504
 INDIA                     |   1996 | 471234564.962198
 INDIA                     |   1995 | 477633020.502078
 INDIA                     |   1994 | 481531821.765077
 INDIA                     |   1993 | 473530266.603691
 INDIA                     |   1992 | 483109353.869535
 INDONESIA                 |   1998 | 266926203.913504
 INDONESIA                 |   1997 | 452837510.033476
 INDONESIA                 |   1996 | 455097697.003911
 INDONESIA                 |   1995 | 453249443.529037
 INDONESIA                 |   1994 |  457836455.69511
 INDONESIA                 |   1993 | 461137998.058957
 INDONESIA                 |   1992 | 458905334.484452
 IRAN                      |   1998 | 273422345.526419
 IRAN                      |   1997 | 462366283.021915
 IRAN                      |   1996 | 468094967.320645
 IRAN                      |   1995 | 468788932.576378
 IRAN                      |   1994 | 460149895.814205
 IRAN                      |   1993 | 465045002.501919
 IRAN                      |   1992 | 465320228.746781
 IRAQ                      |   1998 | 283848088.057988
 IRAQ                      |   1997 | 471861272.104845
 IRAQ                      |   1996 | 470419552.820152
 IRAQ                      |   1995 | 474093207.196398
 IRAQ                      |   1994 | 466792763.670562
 IRAQ                      |   1993 | 470102122.686219
 IRAQ                      |   1992 | 474524357.644706
 JAPAN                     |   1998 | 268609068.073457
 JAPAN                     |   1997 | 456135823.976213
 JAPAN                     |   1996 | 455298951.599356
 JAPAN                     |   1995 | 448114153.042026
 JAPAN                     |   1994 | 447207194.125862
 JAPAN                     |   1993 | 453185436.256846
 JAPAN                     |   1992 | 456571006.885137
 JORDAN                    |   1998 | 273986537.800403
 JORDAN                    |   1997 | 458723652.760473
 JORDAN                    |   1996 |  463814324.52361
 JORDAN                    |   1995 | 460154423.141654
 JORDAN                    |   1994 | 462474890.889525
 JORDAN                    |   1993 | 458215398.318293
 JORDAN                    |   1992 | 455694191.394824
 KENYA                     |   1998 |  282710968.27318
 KENYA                     |   1997 | 467706964.858078
 KENYA                     |   1996 | 476656938.835176
 KENYA                     |   1995 | 473573111.024196
 KENYA                     |   1994 | 461113635.010333
 KENYA                     |   1993 | 475295032.799038
 KENYA                     |   1992 | 470085499.900054
 MOROCCO                   |   1998 | 267760631.004256
 MOROCCO                   |   1997 | 472078210.478632
 MOROCCO                   |   1996 | 470757595.406224
 MOROCCO                   |   1995 | 468044870.221127
 MOROCCO                   |   1994 | 473149277.499307
 MOROCCO                   |   1993 | 470926101.983795
 MOROCCO                   |   1992 | 474885808.498956
 MOZAMBIQUE                |   1998 | 274943118.531634
 MOZAMBIQUE                |   1997 | 468245357.550485
 MOZAMBIQUE                |   1996 | 472413752.123285
 MOZAMBIQUE                |   1995 |  461644305.84761
 MOZAMBIQUE                |   1994 | 477205248.079185
 MOZAMBIQUE                |   1993 | 465917816.254135
 MOZAMBIQUE                |   1992 |  468291341.44479
 PERU                      |   1998 | 281239888.346269
 PERU                      |   1997 |  461297058.55244
 PERU                      |   1996 | 466114296.920626
 PERU                      |   1995 | 459638939.856315
 PERU                      |   1994 |  464462653.42462
 PERU                      |   1993 | 464632636.799494
 PERU                      |   1992 |  465627527.15285
 ROMANIA                   |   1998 | 272460442.914079
 ROMANIA                   |   1997 | 466945103.390736
 ROMANIA                   |   1996 | 466199915.584462
 ROMANIA                   |   1995 | 464672977.224268
 ROMANIA                   |   1994 | 470367837.658226
 ROMANIA                   |   1993 | 469203143.294624
 ROMANIA                   |   1992 | 469491053.737521
 RUSSIA                    |   1998 | 280643315.369301
 RUSSIA                    |   1997 |  471521122.09821
 RUSSIA                    |   1996 | 478115311.163243
 RUSSIA                    |   1995 | 468307535.542963
 RUSSIA                    |   1994 | 474285462.712995
 RUSSIA                    |   1993 | 467911825.196806
 RUSSIA                    |   1992 | 475195547.917715
 SAUDI ARABIA              |   1998 |  273946292.14036
 SAUDI ARABIA              |   1997 | 462277015.321645
 SAUDI ARABIA              |   1996 | 463156861.326991
 SAUDI ARABIA              |   1995 | 467316186.084548
 SAUDI ARABIA              |   1994 | 459402121.591629
 SAUDI ARABIA              |   1993 | 458472441.523836
 SAUDI ARABIA              |   1992 | 465879808.237854
 UNITED KINGDOM            |   1998 |  261755826.93197
 UNITED KINGDOM            |   1997 | 459003750.103491
 UNITED KINGDOM            |   1996 | 457387713.253585
 UNITED KINGDOM            |   1995 | 457340869.479872
 UNITED KINGDOM            |   1994 | 453329850.080606
 UNITED KINGDOM            |   1993 | 464342824.893549
 UNITED KINGDOM            |   1992 | 452569702.035855
 UNITED STATES             |   1998 | 270464851.008856
 UNITED STATES             |   1997 | 461052642.241906
 UNITED STATES             |   1996 |  457955546.29033
 UNITED STATES             |   1995 | 457919685.551547
 UNITED STATES             |   1994 | 460603833.681443
 UNITED STATES             |   1993 | 457686823.637234
 UNITED STATES             |   1992 | 460524543.908855
 VIETNAM                   |   1998 | 267087557.452983
 VIETNAM                   |   1997 | 460581278.821932
 VIETNAM                   |   1996 | 466459848.020906
 VIETNAM                   |   1995 | 464304241.405889
 VIETNAM                   |   1994 | 467651663.983826
 VIETNAM                   |   1993 | 464175256.188593
 VIETNAM                   |   1992 | 468221878.506531
(175 rows)

COMMIT;
COMMIT
