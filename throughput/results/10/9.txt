BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%beige%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 269305659.333517
 ALGERIA                   |   1997 | 454361822.891597
 ALGERIA                   |   1996 | 451300872.539621
 ALGERIA                   |   1995 | 459093151.803559
 ALGERIA                   |   1994 |  460452465.46522
 ALGERIA                   |   1993 | 460211217.806783
 ALGERIA                   |   1992 | 463541527.182294
 ARGENTINA                 |   1998 | 270492639.736207
 ARGENTINA                 |   1997 | 469474985.995788
 ARGENTINA                 |   1996 | 468178686.676945
 ARGENTINA                 |   1995 | 459472837.589783
 ARGENTINA                 |   1994 | 460059223.807679
 ARGENTINA                 |   1993 | 463737925.070009
 ARGENTINA                 |   1992 | 452653883.287463
 BRAZIL                    |   1998 | 276435079.527862
 BRAZIL                    |   1997 | 478793646.403993
 BRAZIL                    |   1996 | 468877048.129878
 BRAZIL                    |   1995 | 472677575.246486
 BRAZIL                    |   1994 | 474367055.531377
 BRAZIL                    |   1993 | 465602724.875121
 BRAZIL                    |   1992 | 475985607.635481
 CANADA                    |   1998 | 277252727.516096
 CANADA                    |   1997 | 471070007.082422
 CANADA                    |   1996 | 464604796.186243
 CANADA                    |   1995 | 472475838.537319
 CANADA                    |   1994 | 477915981.094591
 CANADA                    |   1993 | 466967280.059043
 CANADA                    |   1992 | 477637424.689176
 CHINA                     |   1998 |  278316774.06596
 CHINA                     |   1997 | 476301232.127536
 CHINA                     |   1996 | 462497239.800533
 CHINA                     |   1995 | 467422057.025245
 CHINA                     |   1994 | 470929876.507815
 CHINA                     |   1993 | 469558256.081018
 CHINA                     |   1992 | 479566980.204408
 EGYPT                     |   1998 | 272010535.879265
 EGYPT                     |   1997 | 470856509.947075
 EGYPT                     |   1996 | 472251965.710298
 EGYPT                     |   1995 | 463468586.558914
 EGYPT                     |   1994 | 460292711.530214
 EGYPT                     |   1993 | 462672852.786773
 EGYPT                     |   1992 | 465298586.287206
 ETHIOPIA                  |   1998 | 269649724.186209
 ETHIOPIA                  |   1997 | 452790104.251034
 ETHIOPIA                  |   1996 | 452158934.886038
 ETHIOPIA                  |   1995 |   456757230.0664
 ETHIOPIA                  |   1994 |  461090413.02892
 ETHIOPIA                  |   1993 | 455425740.263329
 ETHIOPIA                  |   1992 | 463547178.804614
 FRANCE                    |   1998 | 262489951.916648
 FRANCE                    |   1997 | 459543227.444118
 FRANCE                    |   1996 | 461796911.800233
 FRANCE                    |   1995 | 447271969.281877
 FRANCE                    |   1994 | 456886570.146975
 FRANCE                    |   1993 | 457810903.549206
 FRANCE                    |   1992 | 461833234.527278
 GERMANY                   |   1998 | 276176287.526741
 GERMANY                   |   1997 | 479537443.464771
 GERMANY                   |   1996 | 478433367.444072
 GERMANY                   |   1995 |  488018415.98121
 GERMANY                   |   1994 |  483469271.99765
 GERMANY                   |   1993 | 485403401.206416
 GERMANY                   |   1992 | 484517988.305104
 INDIA                     |   1998 | 272970764.664598
 INDIA                     |   1997 | 475556986.442535
 INDIA                     |   1996 | 478328572.066003
 INDIA                     |   1995 | 472988199.649229
 INDIA                     |   1994 | 468791474.066923
 INDIA                     |   1993 | 470808640.194937
 INDIA                     |   1992 | 476192475.874447
 INDONESIA                 |   1998 | 275368573.913564
 INDONESIA                 |   1997 | 475672960.450451
 INDONESIA                 |   1996 | 476022670.378382
 INDONESIA                 |   1995 | 465595536.686737
 INDONESIA                 |   1994 | 473341989.607993
 INDONESIA                 |   1993 | 468381398.272721
 INDONESIA                 |   1992 | 462516485.499565
 IRAN                      |   1998 | 273725479.000827
 IRAN                      |   1997 |  463311916.88848
 IRAN                      |   1996 | 463841955.044792
 IRAN                      |   1995 | 460210075.547782
 IRAN                      |   1994 | 457385751.842064
 IRAN                      |   1993 | 454405916.401458
 IRAN                      |   1992 | 463795844.693751
 IRAQ                      |   1998 | 275649127.597676
 IRAQ                      |   1997 | 461653171.103109
 IRAQ                      |   1996 | 478470391.941346
 IRAQ                      |   1995 | 475026912.358179
 IRAQ                      |   1994 | 469276275.877924
 IRAQ                      |   1993 |  468502055.21884
 IRAQ                      |   1992 | 475109764.061233
 JAPAN                     |   1998 | 270527862.639392
 JAPAN                     |   1997 | 453985549.181138
 JAPAN                     |   1996 | 458254801.345469
 JAPAN                     |   1995 | 453629450.237352
 JAPAN                     |   1994 | 456873094.342163
 JAPAN                     |   1993 |  462210017.65464
 JAPAN                     |   1992 | 461203215.802812
 JORDAN                    |   1998 | 270765690.646604
 JORDAN                    |   1997 | 458894695.348674
 JORDAN                    |   1996 | 456831622.500219
 JORDAN                    |   1995 | 455480124.463838
 JORDAN                    |   1994 | 456516164.262659
 JORDAN                    |   1993 | 462384330.883309
 JORDAN                    |   1992 | 467033064.420151
 KENYA                     |   1998 | 268521854.315276
 KENYA                     |   1997 | 472218913.682717
 KENYA                     |   1996 |  465536116.32656
 KENYA                     |   1995 | 469388299.930529
 KENYA                     |   1994 | 470259587.358185
 KENYA                     |   1993 | 462842537.955037
 KENYA                     |   1992 | 475549496.346855
 MOROCCO                   |   1998 | 272944613.381828
 MOROCCO                   |   1997 | 458219834.079036
 MOROCCO                   |   1996 | 473102495.517372
 MOROCCO                   |   1995 | 468750775.480272
 MOROCCO                   |   1994 | 462471137.289968
 MOROCCO                   |   1993 | 468128405.225522
 MOROCCO                   |   1992 | 468358080.511094
 MOZAMBIQUE                |   1998 | 265045467.002775
 MOZAMBIQUE                |   1997 | 442536621.027936
 MOZAMBIQUE                |   1996 | 455991564.140994
 MOZAMBIQUE                |   1995 | 454398153.581679
 MOZAMBIQUE                |   1994 | 453128837.147287
 MOZAMBIQUE                |   1993 | 446947968.782554
 MOZAMBIQUE                |   1992 |  444584739.58652
 PERU                      |   1998 | 278221093.693348
 PERU                      |   1997 | 476815457.328242
 PERU                      |   1996 |  464747180.92565
 PERU                      |   1995 |  468800289.23346
 PERU                      |   1994 | 469112480.111048
 PERU                      |   1993 | 470869788.218107
 PERU                      |   1992 | 467761222.896787
 ROMANIA                   |   1998 | 272752927.124165
 ROMANIA                   |   1997 | 456046503.003367
 ROMANIA                   |   1996 | 465279614.647612
 ROMANIA                   |   1995 | 451561471.249785
 ROMANIA                   |   1994 | 455488223.672856
 ROMANIA                   |   1993 | 458744085.991105
 ROMANIA                   |   1992 | 456813027.083709
 RUSSIA                    |   1998 | 280663153.926084
 RUSSIA                    |   1997 |  476474471.02854
 RUSSIA                    |   1996 |  472695706.90054
 RUSSIA                    |   1995 | 477614610.368021
 RUSSIA                    |   1994 | 473130347.573573
 RUSSIA                    |   1993 | 478296347.304958
 RUSSIA                    |   1992 | 476233921.362453
 SAUDI ARABIA              |   1998 | 277481481.948678
 SAUDI ARABIA              |   1997 |  477051249.66698
 SAUDI ARABIA              |   1996 | 468432907.428743
 SAUDI ARABIA              |   1995 | 475973925.095901
 SAUDI ARABIA              |   1994 | 467719815.978981
 SAUDI ARABIA              |   1993 |  473093637.60076
 SAUDI ARABIA              |   1992 | 478383851.739771
 UNITED KINGDOM            |   1998 |  279144939.57938
 UNITED KINGDOM            |   1997 | 462676357.135782
 UNITED KINGDOM            |   1996 | 460980719.661012
 UNITED KINGDOM            |   1995 | 465361680.697185
 UNITED KINGDOM            |   1994 | 458781167.975887
 UNITED KINGDOM            |   1993 | 462076948.512768
 UNITED KINGDOM            |   1992 | 469786172.473418
 UNITED STATES             |   1998 |  274009693.65038
 UNITED STATES             |   1997 | 466158970.433088
 UNITED STATES             |   1996 | 470481083.241989
 UNITED STATES             |   1995 | 471748631.601956
 UNITED STATES             |   1994 | 470692426.882781
 UNITED STATES             |   1993 |  475476928.06722
 UNITED STATES             |   1992 | 467006592.072042
 VIETNAM                   |   1998 | 273709705.597353
 VIETNAM                   |   1997 | 467641637.541167
 VIETNAM                   |   1996 | 472956640.033224
 VIETNAM                   |   1995 | 467221037.904241
 VIETNAM                   |   1994 |  462767972.66228
 VIETNAM                   |   1993 | 468431626.616022
 VIETNAM                   |   1992 |  465192083.65725
(175 rows)

COMMIT;
COMMIT
