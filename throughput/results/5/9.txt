BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%grey%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 |   265888819.4838
 ALGERIA                   |   1997 | 452391328.395902
 ALGERIA                   |   1996 | 453983493.544953
 ALGERIA                   |   1995 | 457707365.354792
 ALGERIA                   |   1994 | 453940874.037011
 ALGERIA                   |   1993 | 453955162.834646
 ALGERIA                   |   1992 | 451548402.153106
 ARGENTINA                 |   1998 | 273793338.732989
 ARGENTINA                 |   1997 | 475538159.289172
 ARGENTINA                 |   1996 | 472290197.476369
 ARGENTINA                 |   1995 | 460699494.182058
 ARGENTINA                 |   1994 | 462810523.928999
 ARGENTINA                 |   1993 | 464329032.393544
 ARGENTINA                 |   1992 | 463789764.528151
 BRAZIL                    |   1998 | 274081233.406063
 BRAZIL                    |   1997 | 467194067.786025
 BRAZIL                    |   1996 | 465897959.123476
 BRAZIL                    |   1995 | 464531861.830086
 BRAZIL                    |   1994 | 461669250.226677
 BRAZIL                    |   1993 | 464520967.213934
 BRAZIL                    |   1992 | 473739252.589005
 CANADA                    |   1998 | 272306518.783085
 CANADA                    |   1997 | 477935764.303354
 CANADA                    |   1996 | 475220273.636599
 CANADA                    |   1995 | 469406028.076894
 CANADA                    |   1994 | 483714473.215014
 CANADA                    |   1993 | 469709127.967286
 CANADA                    |   1992 | 471541882.619964
 CHINA                     |   1998 | 271428302.957778
 CHINA                     |   1997 | 469598412.534682
 CHINA                     |   1996 | 466053901.303918
 CHINA                     |   1995 | 464428686.588697
 CHINA                     |   1994 | 463366038.441557
 CHINA                     |   1993 | 465506443.136217
 CHINA                     |   1992 | 473577762.360725
 EGYPT                     |   1998 | 276314405.734883
 EGYPT                     |   1997 | 463753710.240568
 EGYPT                     |   1996 | 469927436.529414
 EGYPT                     |   1995 | 455555064.910345
 EGYPT                     |   1994 | 457062089.426011
 EGYPT                     |   1993 | 460647545.226639
 EGYPT                     |   1992 | 459167230.574037
 ETHIOPIA                  |   1998 | 269674142.221693
 ETHIOPIA                  |   1997 | 455830183.727255
 ETHIOPIA                  |   1996 |  457027741.52456
 ETHIOPIA                  |   1995 | 459646842.436881
 ETHIOPIA                  |   1994 | 465432266.657727
 ETHIOPIA                  |   1993 | 461172675.826158
 ETHIOPIA                  |   1992 | 463388347.795417
 FRANCE                    |   1998 | 268252022.681699
 FRANCE                    |   1997 |  456266418.25467
 FRANCE                    |   1996 | 460635503.081849
 FRANCE                    |   1995 | 458531231.591408
 FRANCE                    |   1994 | 455241913.202006
 FRANCE                    |   1993 | 450545069.237515
 FRANCE                    |   1992 |  456466830.93033
 GERMANY                   |   1998 | 282902850.997263
 GERMANY                   |   1997 |  480874387.30459
 GERMANY                   |   1996 | 472265716.989155
 GERMANY                   |   1995 | 483251898.437478
 GERMANY                   |   1994 | 481364142.733642
 GERMANY                   |   1993 | 475832837.027313
 GERMANY                   |   1992 | 469471622.101417
 INDIA                     |   1998 | 274352403.770756
 INDIA                     |   1997 | 480536298.425052
 INDIA                     |   1996 | 476786328.169202
 INDIA                     |   1995 | 467709751.323605
 INDIA                     |   1994 | 480146279.219947
 INDIA                     |   1993 | 471100280.804991
 INDIA                     |   1992 | 475444188.310642
 INDONESIA                 |   1998 | 276181893.465854
 INDONESIA                 |   1997 | 462423641.455947
 INDONESIA                 |   1996 | 462157280.272105
 INDONESIA                 |   1995 | 466280330.929737
 INDONESIA                 |   1994 | 465768217.306653
 INDONESIA                 |   1993 | 467559091.610437
 INDONESIA                 |   1992 | 466048737.899824
 IRAN                      |   1998 | 274569237.459871
 IRAN                      |   1997 | 461713648.867756
 IRAN                      |   1996 | 452970958.423168
 IRAN                      |   1995 |  456982891.15812
 IRAN                      |   1994 | 451598774.398354
 IRAN                      |   1993 | 457950881.027277
 IRAN                      |   1992 | 453270868.765898
 IRAQ                      |   1998 | 277639374.376158
 IRAQ                      |   1997 | 467197524.627137
 IRAQ                      |   1996 | 469004669.744395
 IRAQ                      |   1995 | 466385120.276958
 IRAQ                      |   1994 | 475132339.832342
 IRAQ                      |   1993 | 464067388.610169
 IRAQ                      |   1992 | 473014710.843311
 JAPAN                     |   1998 | 270163966.263054
 JAPAN                     |   1997 | 472157433.109902
 JAPAN                     |   1996 | 460549173.715218
 JAPAN                     |   1995 |  463724314.33267
 JAPAN                     |   1994 | 460487798.956535
 JAPAN                     |   1993 |  463129569.09145
 JAPAN                     |   1992 | 464786427.013895
 JORDAN                    |   1998 | 273719804.808703
 JORDAN                    |   1997 |  463545373.04422
 JORDAN                    |   1996 | 467305592.636605
 JORDAN                    |   1995 | 462277860.489264
 JORDAN                    |   1994 | 459026930.467739
 JORDAN                    |   1993 | 461282983.746923
 JORDAN                    |   1992 | 465268217.802654
 KENYA                     |   1998 | 274102215.700302
 KENYA                     |   1997 | 482927582.575475
 KENYA                     |   1996 |  484850000.72385
 KENYA                     |   1995 | 469468993.780308
 KENYA                     |   1994 |   472342697.1226
 KENYA                     |   1993 | 468985468.934919
 KENYA                     |   1992 | 475751771.305158
 MOROCCO                   |   1998 | 278237953.816242
 MOROCCO                   |   1997 | 470086144.511708
 MOROCCO                   |   1996 |  468744574.49404
 MOROCCO                   |   1995 | 470191666.069732
 MOROCCO                   |   1994 |  466046388.50153
 MOROCCO                   |   1993 | 464962210.546534
 MOROCCO                   |   1992 | 472589846.460169
 MOZAMBIQUE                |   1998 | 268491281.914729
 MOZAMBIQUE                |   1997 | 461079431.165282
 MOZAMBIQUE                |   1996 | 461459610.889967
 MOZAMBIQUE                |   1995 | 457944783.854506
 MOZAMBIQUE                |   1994 | 463608741.874623
 MOZAMBIQUE                |   1993 | 467370948.809953
 MOZAMBIQUE                |   1992 |  467935250.65327
 PERU                      |   1998 | 275751428.439109
 PERU                      |   1997 | 461728423.510282
 PERU                      |   1996 | 461420833.304818
 PERU                      |   1995 | 451989949.504439
 PERU                      |   1994 | 457780165.087027
 PERU                      |   1993 | 455862303.674301
 PERU                      |   1992 | 456312239.502005
 ROMANIA                   |   1998 | 274535776.956265
 ROMANIA                   |   1997 | 465194802.399619
 ROMANIA                   |   1996 | 464606885.061482
 ROMANIA                   |   1995 | 467179556.886317
 ROMANIA                   |   1994 | 468406743.931367
 ROMANIA                   |   1993 | 461391304.112319
 ROMANIA                   |   1992 | 466102949.033167
 RUSSIA                    |   1998 |  273931373.07946
 RUSSIA                    |   1997 | 465013309.435069
 RUSSIA                    |   1996 | 474641258.483454
 RUSSIA                    |   1995 | 470664961.483205
 RUSSIA                    |   1994 | 472112802.458559
 RUSSIA                    |   1993 |  465157664.03621
 RUSSIA                    |   1992 | 469594197.699799
 SAUDI ARABIA              |   1998 | 277410292.515312
 SAUDI ARABIA              |   1997 | 469133128.498186
 SAUDI ARABIA              |   1996 | 464991947.947508
 SAUDI ARABIA              |   1995 | 467435661.305322
 SAUDI ARABIA              |   1994 | 467679893.690816
 SAUDI ARABIA              |   1993 | 465128035.641417
 SAUDI ARABIA              |   1992 | 467266888.879952
 UNITED KINGDOM            |   1998 | 273062081.919842
 UNITED KINGDOM            |   1997 | 460068909.836052
 UNITED KINGDOM            |   1996 | 459882551.894636
 UNITED KINGDOM            |   1995 |  458995197.51881
 UNITED KINGDOM            |   1994 | 459461985.397978
 UNITED KINGDOM            |   1993 | 460238337.436247
 UNITED KINGDOM            |   1992 | 455676665.672374
 UNITED STATES             |   1998 | 271628701.077476
 UNITED STATES             |   1997 | 474923311.856867
 UNITED STATES             |   1996 | 471956772.585247
 UNITED STATES             |   1995 | 464493097.581155
 UNITED STATES             |   1994 | 470197931.083815
 UNITED STATES             |   1993 | 471949245.952661
 UNITED STATES             |   1992 | 470823365.028693
 VIETNAM                   |   1998 | 269004838.818643
 VIETNAM                   |   1997 | 462287617.992334
 VIETNAM                   |   1996 | 462650620.575999
 VIETNAM                   |   1995 |  459874639.08056
 VIETNAM                   |   1994 |  462642302.08703
 VIETNAM                   |   1993 | 466561095.857485
 VIETNAM                   |   1992 |   460109157.1825
(175 rows)

COMMIT;
COMMIT
